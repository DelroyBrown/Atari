<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Pong Game with Sound Effects</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-flow: column;
            height: 100vh;
            background-color: #E4F0FF;
        }

        canvas {
            border: 1px solid #fff;
            -webkit-box-shadow: 8px 8px 24px 0px rgba(66, 68, 90, 1);
            -moz-box-shadow: 8px 8px 24px 0px rgba(66, 68, 90, 1);
            box-shadow: 8px 8px 24px 0px rgba(66, 68, 90, 1);
            border-radius: 10px;
        }
    </style>
</head>

<body>
    <canvas id="pongCanvas"></canvas>
    <script>
        console.log("Script loaded");

        const canvas = document.getElementById('pongCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = 1000;
        canvas.height = 600;

        console.log("Canvas setup");

        // Load the background image
        const backgroundImage = new Image();
        backgroundImage.src = 'atari-logo.jpg';
        console.log("Image src set:", backgroundImage.src);

        backgroundImage.onload = function() {
            console.log("Image loaded");
            startGame();
        };

        backgroundImage.onerror = function() {
            console.error("Image failed to load");
        };

        const audioContext = new (window.AudioContext || window.webkitAudioContext)();

        function playSound(frequency) {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            gainNode.gain.value = 0.1; // Volume control
            oscillator.frequency.value = frequency;
            oscillator.type = 'sine';
            oscillator.start();
            setTimeout(() => oscillator.stop(), 200); // Duration of the sound
        }

        function getRandomNoteFromAChord() {
            const notes = [440, 554.37, 659.25]; // A4, C#5, E5 frequencies
            return notes[Math.floor(Math.random() * notes.length)];
        }

        const ball = {
            x: canvas.width / 2,
            y: canvas.height / 2,
            radius: 10,
            velocityX: 5,
            velocityY: 5,
            speed: 7,
            color: "#0091FF"
        };

        const userPaddle = {
            x: 0,
            y: (canvas.height - 100) / 2,
            width: 10,
            height: 100,
            score: 0,
            color: "#F1F1E6"
        };

        const aiPaddle = {
            x: canvas.width - 10,
            y: (canvas.height - 100) / 2,
            width: 10,
            height: 100,
            score: 0,
            color: "#F6F9FF"
        };

        function drawRect(x, y, width, height, color) {
            ctx.fillStyle = color;
            ctx.fillRect(x, y, width, height);
        }

        function drawArc(x, y, radius, color) {
            ctx.fillStyle = color;
            ctx.beginPath();
            ctx.arc(x, y, radius, 0, Math.PI * 2, true);
            ctx.closePath();
            ctx.fill();
        }

        function drawText(text, x, y) {
            ctx.fillStyle = "#FFF";
            ctx.font = "75px Arial";
            ctx.fillText(text, x, y);
        }

        canvas.addEventListener('mousemove', movePaddle);

        function movePaddle(evt) {
            let rect = canvas.getBoundingClientRect();
            userPaddle.y = evt.clientY - rect.top - userPaddle.height / 2;
        }

        function collisionDetect(player, ball) {
            player.top = player.y;
            player.bottom = player.y + player.height;
            player.left = player.x;
            player.right = player.x + player.width;

            ball.top = ball.y - ball.radius;
            ball.bottom = ball.y + ball.radius;
            ball.left = ball.x - ball.radius;
            ball.right = ball.x + ball.radius;

            return ball.right > player.left && ball.top < player.bottom && ball.left < player.right && ball.bottom > player.top;
        }

        function update() {
            ball.x += ball.velocityX;
            ball.y += ball.velocityY;
            let computerLevel = 0.1;
            aiPaddle.y += (ball.y - (aiPaddle.y + aiPaddle.height / 2)) * computerLevel;

            if (ball.y + ball.radius > canvas.height || ball.y - ball.radius < 0) {
                ball.velocityY = -ball.velocityY;
                playSound(getRandomNoteFromAChord());
            }

            let player = (ball.x < canvas.width / 2) ? userPaddle : aiPaddle;
            if (collisionDetect(player, ball)) {
                playSound(getRandomNoteFromAChord());
                let collidePoint = (ball.y - (player.y + player.height / 2));
                collidePoint = collidePoint / (player.height / 2);
                let angleRad = (Math.PI / 4) * collidePoint;
                let direction = (ball.x < canvas.width / 2) ? 1 : -1;
                ball.velocityX = direction * ball.speed * Math.cos(angleRad);
                ball.velocityY = ball.speed * Math.sin(angleRad);
                ball.speed += 0.1;
            }

            if (ball.x - ball.radius < 0) {
                aiPaddle.score++;
                resetBall();
            } else if (ball.x + ball.radius > canvas.width) {
                userPaddle.score++;
                resetBall();
            }
        }

        function resetBall() {
            ball.x = canvas.width / 2;
            ball.y = canvas.height / 2;
            ball.speed = 7;
            ball.velocityX = -ball.velocityX;
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height); // Clear the canvas
            ctx.drawImage(backgroundImage, 0, 0, canvas.width, canvas.height); // Redraw the background image
            drawRect(userPaddle.x, userPaddle.y, userPaddle.width, userPaddle.height, userPaddle.color);
            drawRect(aiPaddle.x, aiPaddle.y, aiPaddle.width, aiPaddle.height, aiPaddle.color);
            drawArc(ball.x, ball.y, ball.radius, ball.color);
            drawText(userPaddle.score, canvas.width / 4, canvas.height / 5);
            drawText(aiPaddle.score, 3 * canvas.width / 4, canvas.height / 5);
        }

        function game() {
            update();
            draw();
        }

        function startGame() {
            console.log("Game started");
            let framePerSecond = 50;
            setInterval(game, 1000 / framePerSecond);
        }
    </script>
</body>

</html>
